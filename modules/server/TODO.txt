1. XVIZFormatter is only for meta & state_update
 - does not work for other messages

2. websocket must bet string buffer, arraybuffer, not Object

so messy

xvizdata deals with envelop & format
xvizmessage strips envelope

xvizWriters add envelope
xvizWriters do not write other messages beyond metdata & state-update
??? 

[] add functions to create messages in @xviz/io
  what does it reutrn XVIZData or XVIZMessage
[] add writeMessage() to XVIZWriters which requires the envelope


# XVIZ must have the envelope
# 

# parser xviz-loader is binary etc
# isEnvelope, unpackEnvelope

# move the code using this to using XVIZData/XVIZData
XVIZData for a non-parsing flow
XVIZData => XVIZMessage to get an object regardless
  - glb, json, bundle?
  ... message type, need to provide
  ... accessors 
  - message
    - XVIZMeta, state, bundle


# manual testing
## server
node src/main.js --port 3000 --d ../../data/generated/kitti/loaders.gl.2019.02.13.json --delay 100 --format binary 
## client
bin/babel-xviz dump ws://localhost:3000 --log foo  -c

[?] plan for async after this release
[?] XVIZMessage creator
  writeStateUpdate  
  writeMetadata
  writeError

  writeStart
  writeReconfigure
  writeTransformLog
  writeTransformPointInTime



async await issues
  - waiting when you don't need to
    - could use promise.all
    - or save promise and awaith later
      const a1 = someAsync1()
      const a2 = someAsync2()
      await a1
      await a2
      ...

- test case for format conversion
- finish @xviz/io reader
  - test cases here too

  datasource factory
  XVIZDataSource vs DataSource
    provides XVIZ data
    data source is ?
    really data source is file, memory, 
    writes has
      writeSync(name/data) with root
    reader has ?
      readSync(name)
      
  makeXXXDataSource() obj|null
    root, path, params
    
- datasource
  preload
    ? how to know what that means if
      hz is a parameter?
      not everything is a fixed frame
    ? needs a way to specifc 
      min/max frame
      min/max time

- XVIZData
  # takes object|string|arraybuffer|buffer
  # and states "dataFormat" w/o full parsing
    buffer
    message
    hasMessage()
    dataFormat()
  ? can we get actual message/type
    w/o parsing?  need some parsing for GLB I believe
    ... no cheap way to really do this
    ... but we can poke at the data
    memory has to be all in memory 

- XVIZMessage
  # unpacks envelope and sets message type
  ? should unenveloped be supported?
    ? who should feed this a builder?
    ? or a writer
    ? or if it is unenveloped, should user know
    type
    data

- finish server
  - rename ServerMiddleware (vs ClientMiddleWare)
  - option mapping?
    - just do it manually, don't try to be fancy?
  - scenario
  - live
  - loop
  - document middleware

  - xviz Message maker?
  - flow type

  - logging (see CLI?)
  - timing (?)
    process.hrtime()
    performance.now() // limited for security

- probably use kitti data as dataSource for server
  - really need to have filters and reconfig as
    lidar would _suck_ for RT conversion
    ... could split into separate message?
    ... interesting option.

- connect conversion to server as dataSource
- kitti as rosbag

- how to make this all async?
  [?] synchronous for now, async later?

XVIZWriters and output names?
- writers try to maintin convention
  0-
  1-
  ... frames (need to know sequence/index)

  but just converting 1 frame I don't really care 
  
